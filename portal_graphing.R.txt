library(tidyverse)
#install.packages('tidyverse')
surveys <- read.csv('data/portal_data_joined.csv')

#reassign factors for sex
levels(surveys$sex)[1]<-"missing"

#filter missing data - make sure factors are 
#reassigned
surveys_complete <- surveys %>%
  filter(species_id != "",
         !is.na(weight),
         !is.na(hindfoot_length),
         sex!="missing")

#extract the common species (by id)
#what are the common species?
species_counts <-surveys_complete %>%
  group_by(species_id) %>%
  tally

species_common <- species_counts %>% filter(n>=50)

#filter our surveys by list of common species
surveys_complete_common <- surveys_complete %>%
  filter(species_id %in% species_common$species_id)

##PLOTS
#Is hindfoot length correlated with weight?
ggplot(data = surveys_complete_common, aes(x=weight, y=hindfoot_length))+
  geom_point()

#are species different
base_plot <- ggplot(data = surveys_complete_common, aes(x=weight, y=hindfoot_length))
base_plot+geom_point(alpha = .1, aes(color=species_id))
base_plot+geom_point(alpha = .1,color='blue')
base_plot+geom_point(alpha = .1, aes(color=species_id))+
  scale_x_log10()
#add fitted line
base_plot+geom_point(alpha = .1, aes(color=species_id))+
  scale_x_log10()+
  geom_smooth(data=filter(surveys_complete_common,species_id =="PM"),method='lm', aes(color=species_id))

base_plot+geom_point(alpha = .1, aes(color=species_id,shape=species_id))+
  scale_x_log10()+
  geom_smooth(method='lm', aes(color=species_id,shape=species_id))

#What is the distribution of weight within each species?
p<-ggplot(data=surveys_complete_common, aes(x=species_id,y=weight))
p+geom_boxplot()+geom_jitter(alpha=.3,color="tomato")
p+geom_violin()

ggplot(surveys_complete_common,aes(x=weight))+geom_histogram()

#Challenge
#1. Create a boxplot for hindfoot_length for each species
ggplot(data=surveys_complete_common,aes(x=species_id,y=hindfoot_length))+
  geom_boxplot()
#2. Color points based on plot_id
ggplot(data=surveys_complete_common,aes(x=species_id,y=hindfoot_length,color=plot_id))+
  geom_boxplot()+geom_point(alpha=.3)
#put up green sticky
#3. Color plot_id using discrete colors rather than a scale
#hint: change plot_id from int to factor
surveys_complete_common$plot_id <- factor(surveys_complete_common$plot_id)
ggplot(data=surveys_complete_common,aes(x=species_id,y=hindfoot_length))+
  geom_jitter(alpha=.3,aes(color=plot_id))+geom_boxplot(alpha=0)

#Next Challenge
#count the number of each species per year (no graph)
yearly_counts <- surveys_complete_common %>% group_by(year,species_id) %>%
  tally
#plot counts as a function of year
ggplot(yearly_counts, aes(x=year,y=n,color=species_id))+
  geom_point()+geom_line()

#count the number of each species/sex per year
yearly_counts <- surveys_complete_common %>% group_by(year,sex,species_id) %>%
  tally
#plots: each plot contains one species (two lines for sexes)
#each contains one sex (lines for dif species)
ggplot(yearly_counts, aes(x=year,y=n,color=sex))+
  geom_point()+geom_line()+
  facet_wrap(~species_id)
